version: 2.1


jobs:
  deploy:
    machine: true
    steps:
      
      - checkout
      - add_ssh_keys:
          fingerprints:
            - "2d:4a:02:c1:28:6b:7d:7f:48:a3:5a:df:3b:1d:50:23"
      - run:
          name: Sending Dockerfile To Ansible Server
          command: rsync -ravz --delete /home/circleci/project/* ubuntu@184.169.212.155:.
      - run:
          name: Build Dokcer Image
          command: ssh -o StrictHostKeyChecking=no ubuntu@172.31.2.140 docker build -t $JOB_NAME:v1.$BUILD_ID .
    
                     
workflows:
  sample:
    jobs:
      - deploy
      
            
